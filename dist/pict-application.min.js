"use strict";function _defineProperty(t,i,e){return(i=_toPropertyKey(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==typeof i?i:String(i)}function _toPrimitive(t,i){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var o=e.call(t,i||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PictApplication=t()}}((function(){return function t(i,e,o){function s(a,c){if(!e[a]){if(!i[a]){var r="function"==typeof require&&require;if(!c&&r)return r(a,!0);if(n)return n(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var l=e[a]={exports:{}};i[a][0].call(l.exports,(function(t){return s(i[a][1][t]||t)}),l,l.exports,t,i,e,o)}return e[a].exports}for(var n="function"==typeof require&&require,a=0;a<o.length;a++)s(o[a]);return s}({1:[function(t,i,e){class o{constructor(t,i,e){"object"==typeof t&&t.isFable?this.connectFable(t):this.fable=!1,this.fable?(this.UUID=t.getUUID(),this.options="object"==typeof i?i:{}):(this.options="object"!=typeof t||t.isFable?"object"==typeof i?i:{}:t,this.UUID="CORE-SVC-".concat(Math.floor(89999*Math.random()+1e4))),this.serviceType="Unknown-".concat(this.UUID),this.Hash="string"==typeof e?e:this.fable||"string"!=typeof i?"".concat(this.UUID):i}connectFable(t){if("object"!=typeof t||!t.isFable){let i="Fable Service Provider Base: Cannot connect to Fable, invalid Fable object passed in.  The pFable parameter was a [".concat(typeof t,"].}");return console.log(i),new Error(i)}return this.fable||(this.fable=t),this.log||(this.log=this.fable.Logging),this.services||(this.services=this.fable.services),this.servicesMap||(this.servicesMap=this.fable.servicesMap),!0}}_defineProperty(o,"isFableService",!0),i.exports=o,i.exports.CoreServiceProviderBase=o},{}],2:[function(t,i,e){const o=t("fable-serviceproviderbase"),s={Name:"DefaultPictApplication",MainViewportViewIdentifier:"Default-View",MainViewportRenderableHash:!1,MainViewportDestinationAddress:!1,MainViewportDefaultDataAddress:!1,AutoSolveAfterInitialize:!0,AutoRenderMainViewportViewAfterInitialize:!0,AutoRenderViewsAfterInitialize:!1,Manifests:{},IdentifierAddressPrefix:"PICT-"};i.exports=class extends o{constructor(t,i,e){super(t,Object.assign({},JSON.parse(JSON.stringify(s)),i),e),this.serviceType="PictApplication",this.pict=this.fable,this.AppData=this.fable.AppData,this.initializeTimestamp=!1,this.lastSolvedTimestamp=!1,this.lastMarshalFromViewsTimestamp=!1,this.lastMarshalToViewsTimestamp=!1,this.lastAutoRenderTimestamp=!1;let o=Object.keys(this.options.Manifests);if(o.length>0)for(let t=0;t<o.length;t++){let i=o[t];this.fable.instantiateServiceProvider("Manifest",this.options.Manifests[i],i)}}onPreSolve(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onPreSolve:")),!0}onPreSolveAsync(t){return this.onPreSolve(),t()}onBeforeSolve(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onBeforeSolve:")),!0}onBeforeSolveAsync(t){return this.onBeforeSolve(),t()}onSolve(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onSolve:")),!0}onSolveAsync(t){return this.onSolve(),t()}solve(){this.pict.LogNoisiness>2&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," executing solve() function..."));let t=Object.keys(this.pict.providers),i=[];for(let e=0;e<t.length;e++){let o=this.pict.providers[t[e]];o.options.AutoSolveWithApp&&i.push(o)}i.sort(((t,i)=>t.options.AutoSolveOrdinal-i.options.AutoSolveOrdinal));for(let t=0;t<i.length;t++)i[t].solve(i[t]);this.onBeforeSolve();let e=Object.keys(this.pict.views),o=[];for(let t=0;t<e.length;t++){let i=this.pict.views[e[t]];i.options.AutoInitialize&&o.push(i)}o.sort(((t,i)=>t.options.AutoInitializeOrdinal-i.options.AutoInitializeOrdinal));for(let t=0;t<o.length;t++)o[t].solve();return this.onSolve(),this.onAfterSolve(),this.lastSolvedTimestamp=this.fable.log.getTimeStamp(),!0}solveAsync(t){let i=this.fable.instantiateServiceProviderWithoutRegistration("Anticipate");i.anticipate(this.onBeforeSolveAsync.bind(this));let e="function"==typeof t&&t;e||(this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," solveAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),e=t=>{t&&this.log.error("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," solveAsync Auto Callback Error: ").concat(t),t)});let o=Object.keys(this.pict.providers),s=[];for(let t=0;t<o.length;t++){let i=this.pict.providers[o[t]];i.options.AutoSolveWithApp&&s.push(i)}s.sort(((t,i)=>t.options.AutoSolveOrdinal-i.options.AutoSolveOrdinal));for(let t=0;t<s.length;t++)i.anticipate(s[t].solveAsync.bind(s[t]));let n=Object.keys(this.pict.views),a=[];for(let t=0;t<n.length;t++){let i=this.pict.views[n[t]];i.options.AutoSolveWithApp&&a.push(i)}a.sort(((t,i)=>t.options.AutoSolveOrdinal-i.options.AutoSolveOrdinal));for(let t=0;t<a.length;t++)i.anticipate(a[t].solveAsync.bind(a[t]));i.anticipate(this.onSolveAsync.bind(this)),i.anticipate(this.onAfterSolveAsync.bind(this)),i.wait((t=>(this.pict.LogNoisiness>2&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," solveAsync() complete.")),this.lastSolvedTimestamp=this.fable.log.getTimeStamp(),e(t))))}onAfterSolve(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onAfterSolve:")),!0}onAfterSolveAsync(t){return this.onAfterSolve(),t()}onBeforeInitialize(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onBeforeInitialize:")),!0}onBeforeInitializeAsync(t){return this.onBeforeInitialize(),t()}onInitialize(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onInitialize:")),!0}onInitializeAsync(t){return this.onInitialize(),t()}initialize(){if(this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow APPLICATION [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," initialize:")),this.initializeTimestamp)return this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," initialize called but initialization is already completed.  Aborting.")),!1;{this.onBeforeInitialize(),this.onInitialize();let t=Object.keys(this.pict.providers),i=[];for(let e=0;e<t.length;e++){let o=this.pict.providers[t[e]];o.options.AutoInitialize&&i.push(o)}i.sort(((t,i)=>t.options.AutoInitializeOrdinal-i.options.AutoInitializeOrdinal));for(let t=0;t<i.length;t++)i[t].initialize();let e=Object.keys(this.pict.views),o=[];for(let t=0;t<e.length;t++){let i=this.pict.views[e[t]];i.options.AutoInitialize&&o.push(i)}o.sort(((t,i)=>t.options.AutoInitializeOrdinal-i.options.AutoInitializeOrdinal));for(let t=0;t<o.length;t++)o[t].initialize();return this.onAfterInitialize(),this.options.AutoSolveAfterInitialize&&(this.pict.LogNoisiness>1&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," auto solving after initialization...")),this.solve()),this.options.AutoRenderMainViewportViewAfterInitialize&&(this.pict.LogNoisiness>1&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," auto rendering after initialization...")),this.render()),this.initializeTimestamp=this.fable.log.getTimeStamp(),!0}}initializeAsync(t){this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow APPLICATION [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," initializeAsync:"));let i="function"==typeof t&&t;if(i||(this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," initializeAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),i=t=>{t&&this.log.error("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," initializeAsync Auto Callback Error: ").concat(t),t)}),this.initializeTimestamp)return this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," async initialize called but initialization is already completed.  Aborting.")),i();{let t=this.fable.instantiateServiceProviderWithoutRegistration("Anticipate");this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," beginning initialization...")),t.anticipate(this.onBeforeInitializeAsync.bind(this)),t.anticipate(this.onInitializeAsync.bind(this));let e=Object.keys(this.pict.providers),o=[];for(let t=0;t<e.length;t++){let i=this.pict.providers[e[t]];i.options.AutoInitialize&&o.push(i)}o.sort(((t,i)=>t.options.AutoInitializeOrdinal-i.options.AutoInitializeOrdinal));for(let i=0;i<o.length;i++)t.anticipate(o[i].initializeAsync.bind(o[i]));let s=Object.keys(this.pict.views),n=[];for(let t=0;t<s.length;t++){let i=this.pict.views[s[t]];i.options.AutoInitialize&&n.push(i)}n.sort(((t,i)=>t.options.AutoInitializeOrdinal-i.options.AutoInitializeOrdinal));for(let i=0;i<n.length;i++){let e=n[i];t.anticipate(e.initializeAsync.bind(e))}t.anticipate(this.onAfterInitializeAsync.bind(this)),this.options.AutoSolveAfterInitialize&&(this.pict.LogNoisiness>1&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," auto solving (asynchronously) after initialization...")),t.anticipate(this.solveAsync.bind(this))),this.options.AutoRenderMainViewportViewAfterInitialize&&(this.pict.LogNoisiness>1&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," auto rendering (asynchronously) after initialization...")),t.anticipate(this.renderMainViewportAsync.bind(this))),t.wait((t=>(this.initializeTimestamp=this.fable.log.getTimeStamp(),this.pict.LogNoisiness>2&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," initialization complete.")),i())))}}onAfterInitialize(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onAfterInitialize:")),!0}onAfterInitializeAsync(t){return this.onAfterInitialize(),t()}onBeforeMarshalFromViews(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onBeforeMarshalFromViews:")),!0}onBeforeMarshalFromViewsAsync(t){return this.onBeforeMarshalFromViews(),t()}onMarshalFromViews(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onMarshalFromViews:")),!0}onMarshalFromViewsAsync(t){return this.onMarshalFromViews(),t()}marshalFromViews(){this.pict.LogNoisiness>2&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," executing marshalFromViews() function...")),this.onBeforeMarshalFromViews();let t=Object.keys(this.pict.views),i=[];for(let e=0;e<t.length;e++){let o=this.pict.views[t[e]];i.push(o)}for(let t=0;t<i.length;t++)i[t].marshalFromView();return this.onMarshalFromViews(),this.onAfterMarshalFromViews(),this.lastMarshalFromViewsTimestamp=this.fable.log.getTimeStamp(),!0}marshalFromViewsAsync(t){let i=this.fable.instantiateServiceProviderWithoutRegistration("Anticipate"),e="function"==typeof t&&t;e||(this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," marshalFromViewsAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),e=t=>{t&&this.log.error("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," marshalFromViewsAsync Auto Callback Error: ").concat(t),t)}),i.anticipate(this.onBeforeMarshalFromViewsAsync.bind(this));let o=Object.keys(this.pict.views),s=[];for(let t=0;t<o.length;t++){let i=this.pict.views[o[t]];s.push(i)}for(let t=0;t<s.length;t++)i.anticipate(s[t].marshalFromViewAsync.bind(s[t]));i.anticipate(this.onMarshalFromViewsAsync.bind(this)),i.anticipate(this.onAfterMarshalFromViewsAsync.bind(this)),i.wait((t=>(this.pict.LogNoisiness>2&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," marshalFromViewsAsync() complete.")),this.lastMarshalFromViewsTimestamp=this.fable.log.getTimeStamp(),e(t))))}onAfterMarshalFromViews(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onAfterMarshalFromViews:")),!0}onAfterMarshalFromViewsAsync(t){return this.onAfterMarshalFromViews(),t()}onBeforeMarshalToViews(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onBeforeMarshalToViews:")),!0}onBeforeMarshalToViewsAsync(t){return this.onBeforeMarshalToViews(),t()}onMarshalToViews(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onMarshalToViews:")),!0}onMarshalToViewsAsync(t){return this.onMarshalToViews(),t()}marshalToViews(){this.pict.LogNoisiness>2&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," executing marshalToViews() function...")),this.onBeforeMarshalToViews();let t=Object.keys(this.pict.views),i=[];for(let e=0;e<t.length;e++){let o=this.pict.views[t[e]];i.push(o)}for(let t=0;t<i.length;t++)i[t].marshalToView();return this.onMarshalToViews(),this.onAfterMarshalToViews(),this.lastMarshalToViewsTimestamp=this.fable.log.getTimeStamp(),!0}marshalToViewsAsync(t){let i=this.fable.instantiateServiceProviderWithoutRegistration("Anticipate"),e="function"==typeof t&&t;e||(this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," marshalToViewsAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),e=t=>{t&&this.log.error("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," marshalToViewsAsync Auto Callback Error: ").concat(t),t)}),i.anticipate(this.onBeforeMarshalToViewsAsync.bind(this));let o=Object.keys(this.pict.views),s=[];for(let t=0;t<o.length;t++){let i=this.pict.views[o[t]];s.push(i)}for(let t=0;t<s.length;t++)i.anticipate(s[t].marshalToViewAsync.bind(s[t]));i.anticipate(this.onMarshalToViewsAsync.bind(this)),i.anticipate(this.onAfterMarshalToViewsAsync.bind(this)),i.wait((t=>(this.pict.LogNoisiness>2&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," marshalToViewsAsync() complete.")),this.lastMarshalToViewsTimestamp=this.fable.log.getTimeStamp(),e(t))))}onAfterMarshalToViews(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onAfterMarshalToViews:")),!0}onAfterMarshalToViewsAsync(t){return this.onAfterMarshalToViews(),t()}render(t,i,e,o){let s=void 0===t?this.options.MainViewportViewIdentifier:t,n=void 0===i?this.options.MainViewportRenderableHash:i,a=void 0===e?this.options.MainViewportDestinationAddress:e,c=void 0===o?this.options.MainViewportDefaultDataAddress:o;this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow APPLICATION [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," VIEW Renderable[").concat(n,"] Destination[").concat(a,"] TemplateDataAddress[").concat(c,"] render:"));let r="string"==typeof s&&this.servicesMap.PictView[s];return r?r.render(n,a,c):(this.log.error("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," could not render from View ").concat(s," because it is not a valid view.")),!1)}renderMainViewport(){return this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow APPLICATION [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," renderMainViewport:")),this.render()}renderAsync(t,i,e,o,s){let n=void 0===t?this.options.MainViewportViewIdentifier:t,a=void 0===i?this.options.MainViewportRenderableHash:i,c=void 0===e?this.options.MainViewportDestinationAddress:e,r=void 0===o?this.options.MainViewportDefaultDataAddress:o,h="function"==typeof s?s:"function"==typeof o?o:"function"==typeof e?e:"function"==typeof i?i:"function"==typeof t&&t;h||(this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," renderAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),h=t=>{t&&this.log.error("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," renderAsync Auto Callback Error: ").concat(t),t)}),this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow APPLICATION [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," VIEW Renderable[").concat(a,"] Destination[").concat(c,"] TemplateDataAddress[").concat(r,"] renderAsync:"));let l="string"==typeof n&&this.servicesMap.PictView[n];if(!l){let t="PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," could not asynchronously render from View ").concat(n," because it is not a valid view.");return this.pict.LogNoisiness>3&&this.log.error(t),h(new Error(t))}return l.renderAsync(a,c,r,h)}renderMainViewportAsync(t){return this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow APPLICATION [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," renderMainViewportAsync:")),this.renderAsync(t)}renderAutoViews(){}renderAutoViewsAsync(t){let i=this.fable.instantiateServiceProviderWithoutRegistration("Anticipate"),e="function"==typeof t?t:"function"==typeof pTemplateDataAddress?pTemplateDataAddress:"function"==typeof pRenderDestinationAddress?pRenderDestinationAddress:"function"==typeof pRenderableHash?pRenderableHash:"function"==typeof pViewIdentifier&&pViewIdentifier;e||(this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," renderAutoViewsAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),e=t=>{t&&this.log.error("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," renderAutoViewsAsync Auto Callback Error: ").concat(t),t)}),this.pict.LogNoisiness>0&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," beginning renderAutoViewsAsync..."));let o=Object.keys(this.pict.views);o.sort(((t,i)=>this.pict.views[t].options.AutoRenderOrdinal-this.pict.views[i].options.AutoRenderOrdinal));for(let t=0;t<o.length;t++){let e=this.pict.views[o[t]];e.options.AutoRender&&i.anticipate(e.renderAsync.bind(e))}i.wait((t=>(this.lastAutoRenderTimestamp=this.fable.log.getTimeStamp(),this.pict.LogNoisiness>0&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," renderAutoViewsAsync complete.")),e(t))))}}},{"fable-serviceproviderbase":1}]},{},[2])(2)}));
//# sourceMappingURL=pict-application.min.js.map
